<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Questions - Standalone Version</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .question-container {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .category {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
            padding: 5px;
            background-color: #f0f0f0;
            border-radius: 3px;
        }
        .question {
            font-weight: bold;
            margin-bottom: 10px;
        }
        .answer-option {
            margin: 5px 0;
            padding: 5px;
        }
        .answer-option:hover {
            background-color: #f0f0f0;
        }
        .answer-option input {
            margin-right: 10px;
        }
        .answer-option label {
            cursor: pointer;
        }
        .controls {
            margin: 20px 0;
            display: flex;
            justify-content: space-between;
        }
        button {
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .results {
            margin-top: 30px;
        }
        .results-question {
            margin-bottom: 15px;
            padding: 10px;
            border-left: 3px solid #4CAF50;
        }
        .results-question.correct {
            border-left: 3px solid #4CAF50;
        }
        .results-question.incorrect {
            border-left: 3px solid #f44336;
        }
        .selected-answer {
            font-weight: bold;
            color: #4CAF50;
        }
        .correct-selected {
            font-weight: bold;
            color: #4CAF50;
            background-color: rgba(76, 175, 80, 0.1);
        }
        .incorrect-selected {
            font-weight: bold;
            color: #f44336;
            background-color: rgba(244, 67, 54, 0.1);
        }
        .correct-answer {
            color: #4CAF50;
            background-color: rgba(76, 175, 80, 0.1);
        }
        .score-summary {
            margin-bottom: 30px;
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 5px;
            text-align: center;
        }
        .category-filter {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 5px;
        }
        .setting-row {
            margin-bottom: 10px;
        }
        .category-filter select {
            width: 100%;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
            margin-bottom: 10px;
        }
        .start-btn {
            width: 100%;
            margin-top: 10px;
            background-color: #2196F3;
        }
        .start-btn:hover {
            background-color: #0b7dda;
        }
        .progress {
            margin-bottom: 20px;
            text-align: center;
        }
        .hidden {
            display: none;
        }
        .export-section {
            margin-top: 20px;
            text-align: center;
        }
        #export-btn {
            background-color: #ff9800;
        }
        #export-btn:hover {
            background-color: #e68a00;
        }
        .footer {
            margin-top: 30px;
            text-align: center;
            font-size: 12px;
            color: #666;
        }
    </style>
</head>
<body>
    <h1>Exam Questions - Standalone Version</h1>
    
    <div id="exam-settings" class="category-filter">
        <div class="setting-row">
            <label for="category-select">Select Category:</label>
            <select id="category-select">
                <option value="all">All Categories</option>
                <!-- Categories will be loaded here -->
            </select>
        </div>
        <div class="setting-row">
            <label for="question-count">Number of Questions:</label>
            <select id="question-count">
                <option value="5">5</option>
                <option value="10">10</option>
                <option value="15">15</option>
                <option value="20" selected>20</option>
                <option value="30">30</option>
                <option value="50">50</option>
                <option value="all">All Available</option>
            </select>
        </div>
        <button id="start-exam-btn" class="start-btn">Start Exam</button>
    </div>
    
    <div id="progress" class="progress">
        Question <span id="current-question">1</span> of <span id="total-questions">20</span>
    </div>
    
    <div id="question-container" class="question-container">
        <!-- Questions will be loaded here -->
    </div>
    
    <div class="controls">
        <button id="prev-btn" disabled>Previous</button>
        <button id="next-btn">Next</button>
        <button id="finish-btn" class="hidden">Finish Exam</button>
    </div>
    
    <div id="results" class="results hidden">
        <h2>Exam Results</h2>
        <div id="results-container">
            <!-- Results will be loaded here -->
        </div>
        <div class="export-section">
            <button id="export-btn">Export Results as PDF</button>
        </div>
        <button id="restart-btn">Start New Exam</button>
    </div>
    
    <div class="footer">
        <p>This is a standalone HTML file that can be run locally without a server.</p>
    </div>
    
    <!-- Include jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <script>
        // Embedded exam questions data
        const allQuestionsData = 
        // This will be replaced with the actual JSON data
        [{"id":1,"number":"1","category":"REGULAMINY I PODSTAWOWE TERMINY ANGLOJĘZYCZNE\nSTOSOWANE W SŁUŻBIE RADIOKOMUNIKACYJNEJ MORSKIEJ","question":"Zgodnie z kolejnością pierwszeństwa łączności:","answers":[{"option":"A","text":"łączność ostrzegawcza ma pierwszeństwo przed łącznością pilną"},{"option":"B","text":"łączność ostrzegawcza ma pierwszeństwo przed łącznością publiczną"},{"option":"C","text":"łączność pilna ma pierwszeństwo przed łącznością w niebezpieczeństwie"}]}];
        
        // Embedded correct answers data
        const correctAnswersData = 
        // This will be replaced with the actual JSON data
        [{"id":1,"number":"1","category":"REGULAMINY I PODSTAWOWE TERMINY ANGLOJĘZYCZNE\nSTOSOWANE W SŁUŻBIE RADIOKOMUNIKACYJNEJ MORSKIEJ","correct_option":"A"}];
        
        // Global variables
        let allQuestions = allQuestionsData;
        let questions = [];
        let correctAnswers = correctAnswersData;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let correctAnswersMap = {};
        let categories = [];
        let selectedCategory = 'all';
        let questionCount = 20;
        let examStarted = false;
        
        // Initialize the application
        function initializeApp() {
            // Create a map of question ID to correct answer for easy lookup
            correctAnswersMap = {};
            correctAnswers.forEach(answer => {
                correctAnswersMap[answer.id] = answer.correct_option;
            });
            
            // Extract unique categories
            categories = [...new Set(allQuestions.map(q => q.category))];
            
            // Populate category dropdown
            const categorySelect = document.getElementById('category-select');
            // Clear existing options except the first one
            while (categorySelect.options.length > 1) {
                categorySelect.remove(1);
            }
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category.split('\n')[0]; // Use first line of category as display text
                categorySelect.appendChild(option);
            });
            
            // Set up event listeners for exam settings
            document.getElementById('start-exam-btn').addEventListener('click', () => {
                selectedCategory = document.getElementById('category-select').value;
                
                const countSelect = document.getElementById('question-count');
                const countValue = countSelect.value;
                questionCount = countValue === 'all' ? Number.MAX_SAFE_INTEGER : parseInt(countValue);
                
                // Hide settings and show exam
                document.getElementById('exam-settings').style.display = 'none';
                document.getElementById('question-container').classList.remove('hidden');
                document.getElementById('progress').classList.remove('hidden');
                document.querySelector('.controls').classList.remove('hidden');
                
                examStarted = true;
                resetExam();
            });
            
            // Hide question container until exam starts
            document.getElementById('question-container').classList.add('hidden');
            document.getElementById('progress').classList.add('hidden');
            document.querySelector('.controls').classList.add('hidden');
            
            // Set up other event listeners
            setupEventListeners();
        }
        
        // Set up event listeners
        function setupEventListeners() {
            // Add keyboard event listener
            document.addEventListener('keydown', handleKeyboardInput);
            
            // Previous button
            document.getElementById('prev-btn').addEventListener('click', () => {
                if (currentQuestionIndex > 0) {
                    currentQuestionIndex--;
                    displayQuestion(currentQuestionIndex);
                }
            });
            
            // Next button
            document.getElementById('next-btn').addEventListener('click', () => {
                if (currentQuestionIndex < questions.length - 1) {
                    currentQuestionIndex++;
                    displayQuestion(currentQuestionIndex);
                }
            });
            
            // Finish button
            document.getElementById('finish-btn').addEventListener('click', () => {
                showResults();
            });
            
            // Restart button
            document.getElementById('restart-btn').addEventListener('click', () => {
                // Show settings screen again
                document.getElementById('exam-settings').style.display = 'block';
                document.getElementById('question-container').classList.add('hidden');
                document.getElementById('progress').classList.add('hidden');
                document.querySelector('.controls').classList.add('hidden');
                document.getElementById('results').classList.add('hidden');
                examStarted = false;
            });
            
            // Export button
            document.getElementById('export-btn').addEventListener('click', exportResultsAsPDF);
        }
        
        // Reset the exam with the current category filter and question count
        function resetExam() {
            if (!examStarted) return;
            
            // Filter questions by category if needed
            const filteredQuestions = selectedCategory === 'all' 
                ? allQuestions 
                : allQuestions.filter(q => q.category === selectedCategory);
            
            // Shuffle and get the requested number of random questions (or all if less than requested)
            const count = Math.min(filteredQuestions.length, questionCount);
            questions = getRandomQuestions(filteredQuestions, count);
            
            // Initialize user answers array with empty values
            userAnswers = Array(questions.length).fill(null);
            
            // Reset current question index
            currentQuestionIndex = 0;
            
            // Update total questions count
            document.getElementById('total-questions').textContent = questions.length;
            
            // Display the first question
            displayQuestion(currentQuestionIndex);
            
            // Hide results if visible
            const resultsSection = document.getElementById('results');
            resultsSection.classList.add('hidden');
            
            // Show question container and controls
            const questionContainer = document.getElementById('question-container');
            const progressSection = document.getElementById('progress');
            const controls = document.querySelector('.controls');
            
            questionContainer.classList.remove('hidden');
            progressSection.classList.remove('hidden');
            controls.classList.remove('hidden');
        }
        
        // Get random questions from the array
        function getRandomQuestions(allQuestions, count) {
            const shuffled = [...allQuestions].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }
        
        // Display a question
        function displayQuestion(index) {
            const question = questions[index];
            const container = document.getElementById('question-container');
            
            // Update progress
            document.getElementById('current-question').textContent = index + 1;
            
            // Create HTML for the question
            let html = `
                <div class="category">
                    <span>${question.category.split('\n')[0]}</span>
                </div>
                <div class="question">
                    <span>${index + 1}. ${question.question}</span>
                </div>
                <div class="answers">
            `;
            
            // Add answer options
            question.answers.forEach((answer, answerIndex) => {
                const isChecked = userAnswers[index] === answer.option ? 'checked' : '';
                html += `
                    <div class="answer-option">
                        <input type="radio" id="answer-${answerIndex}" name="question-${index}" value="${answer.option}" ${isChecked}>
                        <label for="answer-${answerIndex}">${answer.option}. ${answer.text}</label>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
            
            // Add event listeners to radio buttons
            const radioButtons = container.querySelectorAll('input[type="radio"]');
            radioButtons.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    userAnswers[index] = e.target.value;
                });
            });
            
            // Update button states
            updateButtonStates();
        }
        
        // Update the states of the navigation buttons
        function updateButtonStates() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const finishBtn = document.getElementById('finish-btn');
            
            // Previous button
            prevBtn.disabled = currentQuestionIndex === 0;
            
            // Next button
            if (currentQuestionIndex === questions.length - 1) {
                nextBtn.classList.add('hidden');
                finishBtn.classList.remove('hidden');
            } else {
                nextBtn.classList.remove('hidden');
                finishBtn.classList.add('hidden');
            }
        }
        
        // Calculate the score based on correct answers
        function calculateScore() {
            let correctCount = 0;
            let totalAnswered = 0;
            
            questions.forEach((question, index) => {
                const userAnswer = userAnswers[index];
                if (userAnswer) {
                    totalAnswered++;
                    const correctOption = correctAnswersMap[question.id];
                    if (userAnswer === correctOption) {
                        correctCount++;
                    }
                }
            });
            
            return {
                correct: correctCount,
                total: questions.length,
                answered: totalAnswered,
                percentage: Math.round((correctCount / questions.length) * 100)
            };
        }
        
        // Show results
        function showResults() {
            const questionContainer = document.getElementById('question-container');
            const resultsSection = document.getElementById('results');
            const resultsContainer = document.getElementById('results-container');
            const progressSection = document.getElementById('progress');
            const controls = document.querySelector('.controls');
            
            // Calculate the score
            const score = calculateScore();
            
            // Hide questions and show results
            questionContainer.classList.add('hidden');
            progressSection.classList.add('hidden');
            controls.classList.add('hidden');
            resultsSection.classList.remove('hidden');
            
            // Create HTML for results
            let html = `
                <div class="score-summary">
                    <h3>Your Score: ${score.correct} / ${score.total} (${score.percentage}%)</h3>
                    <p>You answered ${score.answered} out of ${score.total} questions.</p>
                </div>
            `;
            
            // Group questions by category for the results
            const questionsByCategory = {};
            questions.forEach(question => {
                if (!questionsByCategory[question.category]) {
                    questionsByCategory[question.category] = [];
                }
                questionsByCategory[question.category].push(question);
            });
            
            // Display results by category
            Object.keys(questionsByCategory).forEach(category => {
                html += `<h3>${category.split('\n')[0]}</h3>`;
                
                questionsByCategory[category].forEach((question, index) => {
                    const userAnswer = userAnswers[questions.indexOf(question)];
                    const correctOption = correctAnswersMap[question.id];
                    const isCorrect = userAnswer === correctOption;
                    
                    html += `
                        <div class="results-question ${isCorrect ? 'correct' : 'incorrect'}">
                            <div class="question">
                                <span>${question.number}. ${question.question}</span>
                                ${userAnswer ? (isCorrect ? ' ✓' : ' ✗') : ' (Not answered)'}
                            </div>
                            <div class="answers">
                    `;
                    
                    // Add answer options with highlighting for selected and correct answers
                    question.answers.forEach(answer => {
                        const isSelected = userAnswer === answer.option;
                        const isCorrectOption = answer.option === correctOption;
                        let answerClass = '';
                        
                        if (isSelected && isCorrectOption) {
                            answerClass = 'correct-selected';
                        } else if (isSelected && !isCorrectOption) {
                            answerClass = 'incorrect-selected';
                        } else if (!isSelected && isCorrectOption) {
                            answerClass = 'correct-answer';
                        }
                        
                        html += `
                            <div class="answer-option ${answerClass}">
                                ${answer.option}. ${answer.text}
                                ${isSelected ? ' (Your answer)' : ''}
                                ${isCorrectOption ? ' (Correct answer)' : ''}
                            </div>
                        `;
                    });
                    
                    html += '</div></div>';
                });
            });
            
            resultsContainer.innerHTML = html;
        }
        
        // Handle keyboard input for selecting answers (A, B, C)
        function handleKeyboardInput(e) {
            // Only process if we're viewing questions (not results)
            if (document.getElementById('results').classList.contains('hidden') && examStarted) {
                const key = e.key.toLowerCase();
                
                // Handle A, B, C keys for answer selection
                if (['a', 'b', 'c'].includes(key)) {
                    const option = key.toUpperCase();
                    const radioSelector = `input[value="${option}"]`;
                    const radioButton = document.querySelector(radioSelector);
                    
                    if (radioButton) {
                        radioButton.checked = true;
                        userAnswers[currentQuestionIndex] = option;
                        
                        // Visual feedback
                        const label = radioButton.nextElementSibling;
                        label.style.fontWeight = 'bold';
                        setTimeout(() => { label.style.fontWeight = 'normal'; }, 200);
                    }
                }
                
                // Handle arrow keys for navigation
                if (e.key === 'ArrowLeft' && currentQuestionIndex > 0) {
                    currentQuestionIndex--;
                    displayQuestion(currentQuestionIndex);
                } else if (e.key === 'ArrowRight' && currentQuestionIndex < questions.length - 1) {
                    currentQuestionIndex++;
                    displayQuestion(currentQuestionIndex);
                }
            }
        }
        
        // Export results as PDF
        function exportResultsAsPDF() {
            const { jsPDF } = window.jspdf;
            
            // Create a new PDF document
            const doc = new jsPDF();
            
            // Get the results container
            const resultsContainer = document.getElementById('results-container');
            
            // Use html2canvas to capture the results as an image
            html2canvas(resultsContainer).then(canvas => {
                // Get the image data
                const imgData = canvas.toDataURL('image/png');
                
                // Calculate the width and height to fit on the PDF
                const imgWidth = 190;
                const pageHeight = 290;
                const imgHeight = canvas.height * imgWidth / canvas.width;
                let heightLeft = imgHeight;
                
                // Add the image to the PDF
                let position = 10;
                doc.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                // Add new pages if needed
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    doc.addPage();
                    doc.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                // Save the PDF
                doc.save('exam_results.pdf');
            });
        }
        
        // Initialize the application when the DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
